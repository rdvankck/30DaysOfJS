%%[
SET @submitted = RequestParameter("submitted")
SET @showThankYou = "false"

IF @submitted == "true" THEN
    SET @firstName = RequestParameter("firstName")
    SET @lastName = RequestParameter("lastName")
    SET @emailAddress = RequestParameter("emailAddress")
    SET @dob = RequestParameter("dob")
    SET @city = RequestParameter("city")
    SET @consent = RequestParameter("consent")
    SET @consentPR = RequestParameter("consentPR")
    SET @submissionDate = FormatDate(NOW(), "yyyy-MM-dd")

    IF @consent == "on" THEN
        SET @consentBool = "True"
    ELSE
        SET @consentBool = "False"
    ENDIF
    IF @consentPR == "on" THEN
        SET @consentPRBool = "True"
    ELSE
        SET @consentPRBool = "False"
    ENDIF
    IF NOT Empty(@dob) THEN
        SET @dobFormatted = FormatDate(ParseDate(@dob, "yyyy-MM-dd"), "yyyy-MM-dd")
    ELSE
        SET @dobFormatted = ""
    ENDIF

    SET @upsertResult = UpsertData("Jameson_UK_Meatopia_06_2025", 1, "EmailAddress", @emailAddress, 
        "FirstName", @firstName,
        "LastName", @lastName,
        "EmailAddress", @emailAddress,
        "SubmissionDate", @submissionDate,
        "DOB", @dobFormatted,
        "Consent", @consentBool,
        "ConsentPR", @consentPRBool,
        "City", @city
    )
    SET @showThankYou = "true"
ENDIF
]%%

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jameson UK Meatopia 2025</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f5f5f5; }
        .form-container { background: #fff; border-radius: 10px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 40px; max-width: 500px; margin: 50px auto; }
        .thank-you-section { text-align: center; padding: 60px 20px; }
        .thank-you-section h2 { color: #28a745; font-size: 2.2rem; margin-bottom: 20px; }
        .thank-you-section p { font-size: 1.2rem; }
    </style>
</head>
<body>
    <div class="container">
        %%[IF @showThankYou == "true" THEN]%%
        <div class="thank-you-section">
            <h2>Thank You!</h2>
            <p>Your registration was successful.<br>We look forward to seeing you at the event!</p>
        </div>
        %%[ELSE]%%
        <div class="form-container">
            <h1 class="mb-4">Jameson UK Meatopia 2025</h1>
            <form method="post" action="" id="registrationForm">
                <input type="hidden" name="submitted" value="true">
                <div class="mb-3">
                    <label for="firstName" class="form-label">First Name *</label>
                    <input type="text" class="form-control" id="firstName" name="firstName" required maxlength="50">
                </div>
                <div class="mb-3">
                    <label for="lastName" class="form-label">Last Name *</label>
                    <input type="text" class="form-control" id="lastName" name="lastName" required maxlength="50">
                </div>
                <div class="mb-3">
                    <label for="emailAddress" class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="emailAddress" name="emailAddress" required maxlength="254">
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth *</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                </div>
                <div class="mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" class="form-control" id="city" name="city" maxlength="50">
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="consent" name="consent" required>
                    <label class="form-check-label" for="consent">
                        I consent to receive marketing communications from Jameson *
                    </label>
                </div>
                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="consentPR" name="consentPR">
                    <label class="form-check-label" for="consentPR">
                        I consent to receive promotional materials and event updates
                    </label>
                </div>
                <button type="submit" class="btn btn-warning w-100">Register Now</button>
            </form>
        </div>
        %%[ENDIF]%%
    </div>
</body>
</html>
